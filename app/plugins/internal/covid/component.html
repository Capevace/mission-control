<script type="module">
    const { dashboard } = MISSION_CONTROL;

    const covidComponent = {
		components: {
			ServiceProvider: MISSION_CONTROL.components.headless.ServiceProvider,
		},
        template: `
			<ServiceProvider service="covid" v-slot="{ cities }">
				<section class="w-full">
					<div class="dashboard-box-heading mb-3">
						COVID-19 Data <span class="ml-1 text-primary-500">(Last 7 days)</span>
					</div>
					<div class="flex flex-wrap w-full gap-5">
						<div class="dashboard-box min-w-sm flex-1" v-for="city of filterCities(cities)">
							<div class="font-semibold text-primary-200 flex justify-between items-center">
								{{city.label}}
							</div>
							<div class="flex text-primary-50 font-semibold">
								<div class="mr-2">
									<div class="font-bold text-2xl ">{{city.casesPerPopulation | round}}</div>
									<div class="text-xs text-primary-500 ">per 100.000</div>
								</div>
								<div>
									<div class="font-bold text-2xl">{{city.casesLast7Days}}</div>
									<div class="text-xs text-primary-500 ">cases</div>
								</div>
							</div>
						</div>
					</div>
				</section>
			</ServiceProvider>
        `,
        methods: {
			filterCities(cities) {
                return Object.values(cities);
            },
            historicalGraphPoints(id) {
                const rValues = this.covidState.historical[id]
                    .map(row => row.r); // R-Wert
                
                const maxR = Math.max(...rValues);

                return rValues.reduce(
                        (points, r, index) => 
                            `${points} ${index * 20},${0}`,
                        ''
                    )
            }
        },
        filters: {
            dateify(value) {
                return new Date(value).toLocaleDateString();
            },

            round(value) {
                return value.toFixed(2);
            },

            graphPoints(values) {
                
            }
        }
    };

    dashboard.component('covid', covidComponent);

</script>