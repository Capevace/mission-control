<script>
    MISSION_CONTROL.dashboard.component('homekitSwitches', {
        template: `
            <div class="flex">
                <template
                    v-if="homekitState.initialized"
                    >

                     <virtual-switch
                        v-for="(service) in homekitState.services"
                        v-if="service.name !== 'Homebridge 4E81'"
                        :key="service.uniqueId"
                        :active="isServiceActive(service)"
                        icon="home"
                        @click="toggle(service.uniqueId, { On: !isServiceActive(service) })"
                    >
                        {{ service.name }}
                    </virtual-switch>
                </template>
                <p v-else class="text-main text-xs leading-normal ">
                    You need to set a <a class="text-main" href="https://github.com/homebridge/homebridge">homebridge</a> pin in config (found in ~/.mission-control/config) or by specifying the <pre class="inline font-mono ">--homebridge-pin [pin]</pre> CLI option for devices to be listed here.
                </p>
            </div>
        `,
        components: {
            'virtual-switch': MISSION_CONTROL.components.switch
        },
        computed: {
            homekitState() {
                return this.$mcState('homekit', {
                    services: {}
                });
            }
        },
        methods: {
            toggle(uniqueId, changes) {
                MISSION_CONTROL.dashboard.invokeAction('HOMEKIT:MODIFY-CHARACTERISTICS', {
                    uniqueId,
                    changes
                });
            },

            isServiceActive(service) {
                return !!service.values.On;
            }
        }
    });

</script>