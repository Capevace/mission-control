<script>
    const leftPad = MISSION_CONTROL.utils.leftPad;

    function dateToTime(date) {
        const hours = leftPad(date.getHours(), 2, '0');
        const minutes = leftPad(date.getMinutes(), 2, '0');

        return `${hours}:${minutes}`;
    }


    MISSION_CONTROL.dashboard.component('bahn', {
        template: `
            <section class="w-full h-full flex flex-col justify-start">
                <div class="dashboard-title mb-2">Trains to LÃ¼beck Hbf</div>
                <div class="list-none p-0 w-full text-main-lightest inline-block overflow-y-scroll h-full">
                    <div class="absolute bottom-0 w-full h-8 bg-gradient-to-t from-main to-transparent rounded-xl"></div>
                    <div
                        v-for="(route) in bahnState.routes"
                        class="list-reset bg-main-dark mb-3 flex rounded-2xl overflow-hidden"
                    >
                        <div class="pr-3 text-2xl font-mono text-main-lightest px-3 py-2">
                            <div>{{route.departure | dateify}}<span v-if="route.departureDelay">{{route.departureDelay}}</span></div>
                            <div>{{route.arrival | dateify}}<span v-if="route.arrivalDelay">{{route.arrivalDelay}}</span></div>
                        </div>

                        <div class="bg-main-darkest border-main-dark border-8 rounded-2xl w-full px-2 py-1">
                            <table class="text-base" v-if="route.buses && route.buses.length > 0">
                                <tr
                                    v-for="bus in route.buses"
                                    class="text-left"
                                >
                                    <td class="pr-2 text-main-lightest">{{bus.name}}</td>
                                    <td class="text-main-lighter font-mono pr-1 text-sm">{{bus.departure | dateify}}</td>
                                    <td class="text-main-lighter font-mono text-sm">- {{bus.arrival | dateify}}</td>
                                </tr>
                            </table>
                            <div v-else class="text-sm text-main-lighter">No busses found</div>
                        </div>
                    </div>

                </div>
            </section>
        `,
        computed: {
            bahnState() {
                return this.$mcState('bahn', {
                    routes: []
                });
            }
        },
        methods: {

        },
        filters: {
            dateify(value) {
                return dateToTime(new Date(value));
            },

            minuteify(value) {
                const v = new Date(value)
                    .toLocaleTimeString([], {minute: '2-digit'});

                return v.length === 1
                    ? `0${v}`
                    : v;
            }
        }
    })
</script>

<style type="text/css">
table td, table td * {
    vertical-align: top;
}
</style>
